
 AMMS (Account ManageMent for SQUID)

 Система управления аккаунтами пользователей SQUID. Обеспечивает
 подсчет трафика и блокировку пользователей.

 Конфигурационный файл:

    Формат и возможности описаны в:
 http://search.cpan.org/~tlinden/Config-General-2.48/General.pm

 Архитектура

    ammsc - консольный клиент управления системой
    ammsd - (однопроцессный FCGI) управление аккаунтами, API
    ammsed - (многопроцессный FCGI) запуск расширений
    ammsrd - редиректор для SQUID.
    ammstc - счетчик трафика
    hash - консольный клиент hashd
    hashd - (однопроцессный FCGI) управление хэшами (списки доступа, привязка ip и т.п)

    Клиент-серверное взаимодействие осуществляется по протоколу HTTP, формат передачи
    данных JSON.

 Лимиты:

    Лимиты разделяются на три типа: временные (T), обычные (I), родительские (P).
 Основной приоритет имеет временный лимит, потом обычный и родительский.
 Если лимит не имеет каких то параметров, он их заимствует у родительского.

 Параметры лимита: 

    * Имя
    * Родитель
    * Объем трафика (КБ,МБ,ГБ)
    * Временной период (s,m,h,d) (секунда, минута, час, день)
    * Состояние (статус) (0 - выключен, 1 - включен, 2 - заблокирован)

 Описание
 
    Временной период высчитывается в зависимости от типа таймера указанного в конфигурационном
 файле (abs - абсолютный таймер, rel - относительный). При rel таймере интервал высчитывается
 от времени изменения лимита, при abs - от границы временного периода.

 Расширения:

    Расширения прописываются в секции <extension> конфиг. файла. Они могут быть написаны на любом
 языке программирования, запускаются как внешние программы, аргументы передаются в командной строке,
 считывается stdout, stderr.

 События:

    Обработчик событый прописывается в секции <event>.
 События генерируются ammsd и обрабатываются расширениями. Пример: check_access.disabled_by_sys
 вызывается когда лимит пользователя отключается системой при превышении трафика.

 Интеграция со SQUID:

    Контроль доступа осуществляется редиректором ammsrd, подсчет трафика на основе лог-файла
 осуществляет ammstc.


